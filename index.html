<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>TikTok Coins 3D Ultra Real</title>
<style>
:root {
  --bg:#FFFFFF; --card:#FFFFFF; --field:#FAFAFA;
  --tiktok-red:#FE2C55; --tiktok-cyan:#25F4EE;
  --text:#000; --muted:#555; --policy:#777;
  --coin-yellow:#FFD700; --confirm-green:#34C759;
}
*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","Segoe UI",Roboto;margin:0;padding:0;}
body{background:var(--bg);display:flex;justify-content:center;min-height:100vh;color:var(--text);}
.app{width:100%;max-width:430px;padding:16px;}
.header{text-align:center;font-weight:700;font-size:24px;margin:12px 0 16px;}
.card{background:var(--card);border-radius:22px;padding:18px;box-shadow:0 3px 10px rgba(0,0,0,0.08);}
.user{display:flex;gap:12px;align-items:center;margin-bottom:16px;}
.avatar{width:48px;height:48px;border-radius:50%;background:var(--field);display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--confirm-green);}
.user input{flex:1;background:var(--field);border:none;outline:none;color:var(--text);padding:14px;border-radius:16px;font-size:16px;border:1px solid #ccc;}
.balance{text-align:center;margin:20px 0;}
.balance .coins{font-size:44px;font-weight:800;transition:.25s;color:var(--coin-yellow);}
.balance span{font-size:14px;color:var(--muted);}
.packages{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;}
.pkg{background:#FAFAFA;border-radius:20px;padding:18px 10px;text-align:center;cursor:pointer;color:var(--text);border:2px solid var(--tiktok-red);position:relative;overflow:hidden;transition:.25s;}
.pkg svg.coin-icon{width:28px;height:28px;margin-bottom:6px;}
.pkg span.number{display:block;font-size:22px;font-weight:700;color:var(--text);}
.pkg span.price{display:block;font-size:14px;color:var(--text);}
.pkg:hover{box-shadow:0 0 12px rgba(254,44,85,0.3);}
.pkg:active{transform:scale(.96);}
.pkg.disabled{opacity:.35;pointer-events:none;}
.history{margin-top:10px;border-top:1px solid #ddd;padding-top:10px;}
.history h4{font-size:13px;font-weight:600;color:var(--muted);margin:0 0 6px;}
.item{display:flex;justify-content:space-between;font-size:14px;padding:4px 0;opacity:0;transform:translateY(-10px);transition:all .35s ease;}
.coin{position:fixed;width:28px;height:28px;border-radius:50%;background:radial-gradient(circle at 30% 30%,#FFD700,#FFA500);box-shadow:0 0 8px #FFD700 inset;pointer-events:none;transition:transform 1s cubic-bezier(.22,.61,.36,1), opacity 1s;z-index:2000;will-change:transform,opacity;}
.particle{position:fixed;width:6px;height:6px;border-radius:50%;background:var(--coin-yellow);pointer-events:none;will-change:transform,opacity;mix-blend-mode:screen;filter:blur(1px);}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.3);backdrop-filter:blur(6px);display:flex;align-items:center;justify-content:center;z-index:999;opacity:0;animation:fadein .15s forwards;}
@keyframes fadein{from{opacity:0}to{opacity:1}}
.sheet{width:90%;max-width:380px;background:var(--card);border-radius:26px;padding:22px;animation:up .35s cubic-bezier(.22,.61,.36,1);}
.sheet button{width:100%;margin-top:12px;padding:14px;border:none;border-radius:16px;font-size:16px;font-weight:600;cursor:pointer;transition:transform .15s, box-shadow .2s;}
.confirm{background:linear-gradient(135deg,var(--tiktok-cyan),var(--tiktok-red));color:#fff;box-shadow:0 0 10px rgba(254,44,85,0.5);}
.confirm:active{transform:scale(.95);box-shadow:0 0 20px rgba(254,44,85,0.8);}
.cancel{background:var(--field);color:var(--text);border:1px solid var(--tiktok-red);}
.success{text-align:center;background:#fff;border-radius:26px;color:var(--text);}
.check{width:96px;height:96px;border-radius:50%;background:linear-gradient(135deg,var(--confirm-green),var(--tiktok-cyan));margin:10px auto 14px;display:flex;align-items:center;justify-content:center;font-size:46px;font-weight:900;animation:check .4s ease-out,glowCheck 1.2s infinite alternate;}
@keyframes check{0%{transform:scale(.4)}60%{transform:scale(1.15)}100%{transform:scale(1)}}
@keyframes glowCheck{0% {box-shadow:0 0 8px rgba(52,199,89,0.6),0 0 12px rgba(37,244,238,0.4);} 100% {box-shadow:0 0 18px rgba(52,199,89,1),0 0 28px rgba(37,244,238,0.6);}}
.policy-footer{font-size:11px;color:var(--policy);text-align:center;margin-top:8px;}
.policy-footer a{color:#007BFF;text-decoration:none;}
.policy-footer a:hover{text-decoration:underline;}
.error{font-size:12px;color:#FE2C55;margin-top:6px;display:none;}
</style>
</head>
<body>
<div class="app">
  <div class="header">TikTok Coins</div>
  <div class="card">
    <div class="user">
      <div class="avatar" id="avatar">U</div>
      <input id="user" placeholder="@usuario">
    </div>
    <div class="error" id="error">Formato inválido</div>
    <div class="balance">
      <div class="coins" id="saldo">0</div>
      <span>Monedas</span>
    </div>
    <div class="packages">
      <div class="pkg" data-c="70"><svg class="coin-icon" viewBox="0 0 64 64"><circle cx="32" cy="32" r="30" fill="gold"/><circle cx="32" cy="32" r="20" fill="orange"/></svg><span class="number">70</span><span class="price">~$0.99</span></div>
      <div class="pkg" data-c="350"><svg class="coin-icon" viewBox="0 0 64 64"><circle cx="32" cy="32" r="30" fill="gold"/><circle cx="32" cy="32" r="20" fill="orange"/></svg><span class="number">350</span><span class="price">~$4.99</span></div>
      <div class="pkg" data-c="700"><svg class="coin-icon" viewBox="0 0 64 64"><circle cx="32" cy="32" r="30" fill="gold"/><circle cx="32" cy="32" r="20" fill="orange"/></svg><span class="number">700</span><span class="price">~$9.99</span></div>
      <div class="pkg" data-c="1400"><svg class="coin-icon" viewBox="0 0 64 64"><circle cx="32" cy="32" r="30" fill="gold"/><circle cx="32" cy="32" r="20" fill="orange"/></svg><span class="number">1400</span><span class="price">~$19.99</span></div>
      <div class="pkg" data-c="2800"><svg class="coin-icon" viewBox="0 0 64 64"><circle cx="32" cy="32" r="30" fill="gold"/><circle cx="32" cy="32" r="20" fill="orange"/></svg><span class="number">2800</span><span class="price">~$39.99</span></div>
      <div class="pkg" data-c="5600"><svg class="coin-icon" viewBox="0 0 64 64"><circle cx="32" cy="32" r="30" fill="gold"/><circle cx="32" cy="32" r="20" fill="orange"/></svg><span class="number">5600</span><span class="price">~$79.99</span></div>
    </div>
    <div class="policy-footer">
      <a href="https://www.tiktok.com/legal/virtual-items?lang=es" target="_blank">Políticas oficiales de TikTok sobre Coins</a>
    </div>
    <div class="history">
      <h4>Historial</h4>
      <div id="hist"></div>
    </div>
  </div>
</div>

<audio id="coinSound" src="https://actions.google.com/sounds/v1/cartoon/coin.ogg"></audio>
<audio id="clickSound" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>
<audio id="successSound" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>

<script>
const user=document.getElementById("user"), avatar=document.getElementById("avatar"), saldo=document.getElementById("saldo"), error=document.getElementById("error"), hist=document.getElementById("hist");
const USERS={}, historial=[]; let currentUser=null;

function lock(b){document.querySelectorAll(".pkg").forEach(p=>p.classList.toggle("disabled",b));}
lock(true);

user.addEventListener("input",()=>{
  const u=user.value.trim(), regex=/^@[a-zA-Z0-9._-]{1,30}$/;
  if(!regex.test(u)){error.style.display="block"; avatar.textContent="U"; saldo.textContent=0; hist.innerHTML=""; lock(true); currentUser=null; return;}
  error.style.display="none"; currentUser=u; avatar.textContent=u[1].toUpperCase();
  if(!USERS[u]) USERS[u]={saldo:0};
  saldo.textContent=USERS[u].saldo; historial.length=0; hist.innerHTML=""; lock(false);
});

document.querySelectorAll(".pkg").forEach(pkg=>{
  pkg.addEventListener("click",()=>{
    if(!currentUser) return;
    playSound('clickSound');
    openConfirm(pkg,+pkg.dataset.c);
  });
});

function openConfirm(pkg,coins){
  const o=document.createElement("div"); o.className="overlay";
  o.innerHTML=`<div class="sheet">
    <div style="text-align:center;font-size:14px;color:#555">Confirmar compra</div>
    <div style="text-align:center;font-size:26px;font-weight:800;margin:8px 0">${coins} monedas</div>
    <button class="confirm">Confirmar</button>
    <button class="cancel">Cancelar</button>
  </div>`; document.body.appendChild(o);

  o.querySelector(".confirm").addEventListener("click",()=>{
    navigator.vibrate?.(50); playSound('coinSound'); o.remove();
    requestAnimationFrame(()=>processPurchase(pkg,coins));
  });
  o.querySelector(".cancel").addEventListener("click",()=>{
    playSound('clickSound'); o.remove();
  });
}

function processPurchase(pkg,coins){
  const r=pkg.getBoundingClientRect(), s=saldo.getBoundingClientRect();
  const count=Math.min(40,15+Math.floor(Math.random()*25));
  for(let i=0;i<count;i++){setTimeout(()=>flyCoin(r,s),i*20);}
  animateBalance(coins); addHistory(coins); setTimeout(()=>showSuccess(coins),2500);
}

function flyCoin(start,end){
  const c=document.createElement("div"); c.className="coin";
  c.style.left=start.left+"px"; c.style.top=start.top+"px";
  document.body.appendChild(c);
  c.getBoundingClientRect(); // fuerza layout para animación en iOS
  const dx=end.left-start.left + (Math.random()*30-15), dy=end.top-start.top + (Math.random()*30-15);
  c.style.transition='transform 1s cubic-bezier(.22,.61,.36,1), opacity 1s';
  requestAnimationFrame(()=>{c.style.transform=`translate(${dx}px,${dy}px) scale(0.5) rotate(${360+Math.random()*360}deg)`; c.style.opacity=0;});
  setTimeout(()=>c.remove(),1100);
  createParticles(start.left+14,start.top+14);
}

function createParticles(x,y){
  for(let i=0;i<25;i++){
    const p=document.createElement("div"); p.className="particle";
    p.style.left=x+"px"; p.style.top=y+"px"; document.body.appendChild(p);
    const a=Math.random()*2*Math.PI, d=15+Math.random()*30;
    requestAnimationFrame(()=>{p.style.transform=`translate(${Math.cos(a)*d}px,${Math.sin(a)*d}px)`; p.style.opacity=0;});
    setTimeout(()=>p.remove(),700);
  }
}

function animateBalance(add){
  const base=USERS[currentUser].saldo, target=base+add; USERS[currentUser].saldo=target;
  let cur=base, step=Math.ceil(add/25);
  const i=setInterval(()=>{cur+=step; if(cur>=target){cur=target; clearInterval(i);}
    saldo.textContent=cur; saldo.style.transform="scale(1.3)";
    setTimeout(()=>saldo.style.transform="scale(1)",80);
  },25);
}

function addHistory(coins){
  const t=new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
  historial.unshift({coins,t}); historial.splice(5);
  hist.innerHTML="";
  historial.forEach(h=>{
    const div=document.createElement("div"); div.className="item";
    div.innerHTML=`<span>+${h.coins}</span><span>${h.t}</span>`;
    hist.appendChild(div);
    setTimeout(()=>{div.style.opacity=1; div.style.transform='translateY(0)';},50);
  });
}

function showSuccess(coins){
  playSound('successSound');
  const o=document.createElement("div"); o.className="overlay";
  o.innerHTML=`<div class="sheet success">
    <div class="check">✓</div>
    <div style="font-size:18px;font-weight:700">Compra realizada</div>
    <div style="font-size:14px;margin-top:4px">+${coins} monedas añadidas</div>
  </div>`; document.body.appendChild(o);
  setTimeout(()=>o.remove(),1800);
}

function playSound(id){const s=document.getElementById(id); if(s){s.currentTime=0; s.play().catch(()=>{});}}
</script>
</body>
</html>
